# TSO500 variant annotation and filtration pipeline

This Bash script automates VCF processing from hg19/GRCh37, including LiftOver, VEP and OncoKB annotation, and the generation of a final table filtered by specific transcripts.

## üöÄ Overview of the Workflow

The script iterates through all compressed VCF files (`.vcf.gz`) located in the `./OriginalVcf` directory and performs the following major steps for each sample:

* **Filtering:** Keeps only variants marked as `PASS`.
* **LiftOver:** Converts genomic coordinates from **hg19** to **hg38**.
* **VEP Annotation:** Adds comprehensive functional and clinical annotations.
* **OncoKB Annotation:** Incorporates therapeutically relevant annotations.
* **Table Generation:** Converts the final annotated VCF into a readable CSV table.
* **Summary:** Tracks variant counts at each stage. Usefull while development to see is variants are missed in the previous steps.

## üõ†Ô∏è Prerequisites and Dependencies

This pipeline relies heavily on containerization and specific tools. Ensure you have the following installed and configured:

1.  **Apptainer/Singularity:** Used to run tools like `bcftools` and GATK in containers.
2.  **GATK (v4.6.0.0 or later):** Used for the LiftOver step (run via Apptainer).
3.  **VEP (Variant Effect Predictor):** Installed locally with necessary plugins (SpliceAI, REVEL) and custom databases (ClinVar, CIViC, CancerHotspots).
4.  **Custom Python Scripts:**
    * `oncokb2.0.py`: For communicating with the OncoKB API and annotating the VCF.
    * `vcf2table.py`: For parsing the final VCF and generating a CSV table, using a transcript list (`TSO500_transcripts_list.txt`).
5.  **Reference Files:**
    * **Chain File:** `hg19ToHg38.over.chain` for LiftOver.
    * **Reference Genome:** `hg38.fa` (FASTA format).

## üìÇ Directory Structure

The script is configured to use the following structure. It will automatically create the necessary output directories:

| Directory | Purpose |
| :--- | :--- |
| `./OriginalVcf` | **Input directory.** Contains the initial VCF files (`*.vcf.gz`). |
| `./FilteredVcf` | VCF files after filtering for `PASS` variants. |
| `./LiftOverVcf` | VCF files with coordinates lifted from hg19 to hg38. |
| `./LiftOverVcf/Rejected` | VCF files containing variants that failed the LiftOver step. |
| `./AnnotatedVcf` | VCF files after comprehensive VEP annotation. |
| `./OncoKB_VCF` | Final VCF files after OncoKB clinical annotation. |
| `./Table` | Final output CSV tables generated by `vcf2table.py`. |


> **Note on Reference Files Source:**
> * **Chain File (`hg19ToHg38.over.chain`):** Sourced from UCSC.
    >    **Download URL:** `https://hgdownload.soe.ucsc.edu/goldenPath/hg19/liftOver/hg19ToHg38.over.chain.gz`
> * **Reference Genome (`hg38.fa`):** The GRCh38 reference genome FASTA used in this pipeline was sourced from NCBI and corresponds to the **GRCh38 analysis set** (with alternate contigs masked and the decoy sequence included).
    >    **Download URL:** `https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/001/405/GCF_000001405.40_GRCh38.p14/GRCh38_major_release_seqs_for_alignment_pipelines/GCA_000001405.15_GRCh38_no_alt_plus_hs38d1_analysis_set.fna.gz`


## ‚öôÔ∏è Running the Pipeline

### 1. Setup

* Create your Conda env 

```bash
conda env create -f TSO500_environment.yml -n TSO500
```

* Place your input Dragen VCF files (named `D21_11111_22222_Breast_33333_S1.dragen.concat_snv_sv.vcfz`) into the `./OriginalVcf` directory.
* Ensure the required chain file and reference FASTA are correctly specified by the `CHAIN` and `REF` variables.
* Verify the paths to VEP, its caches, plugins, and custom databases are correct.

* Ensure you provide the oncoKB token 

### 2. Execution Notes and Performance

* This script is designed as a complete, end-to-end pipeline for VCF processing.

```bash
./DoIt.sh YOUR_ONCOKB_TOKEN
```

* **Progress Tracking:** It includes numerous `echo` and `print` statements throughout its steps to provide real-time progress and status updates during execution.
* **Performance:** Processing the entire analysis (e.g., 419 samples) typically takes several hours, based on the performance observed on the training server where the script was developed.
* **Running in Background:** (If running many samples) To ensure the pipeline runs uninterruptedly until completion, it is recommended to execute it in the background using the `nohup` (slurm or similar) command, which directs output to a log file (`DoIt.log`):

```bash
nohup ./DoIt.sh YOUR_ONCOKB_TOKEN > DoIt.log 2>&1 &
```

## üìù Step-by-Step Details

### Cleanup and Setup

The script first cleans up previous results in all output directories and creates a new summary file (`variant_counts.txt`).

### Step 1: PASS Filtering

Uses `awk` with `zcat` and `bgzip` to efficiently filter the input VCF file, retaining the header and only variants where the `FILTER` column (column 7) is exactly `PASS`. 

### Step 2: LiftOver (hg19 to hg38)

Uses **GATK's `LiftoverVcf`** tool, run via Apptainer, to convert coordinates from hg19 (GRCh37) to hg38 (GRCh38). 
* **Rejected Variants:** Variants that fail the conversion are written to the `Rejected` directory.

### Step 3: VEP Annotation

Runs the **Ensembl VEP** for comprehensive annotation.
* **Configuration:** Uses `--everything`, `--offline`, and custom annotations including **SpliceAI**, **REVEL**, **ClinVar**, **CIViC**, and **CancerHotspots** databases to add functional and clinical context.

### Step 4: OncoKB Annotation

This Python script serves as the core clinical annotation engine for the pipeline. It interacts directly with the **OncoKB Precision Oncology Knowledge Base** API to enrich VEP-annotated VCF files with therapeutic, diagnostic, and prognostic information.

#### Key Features

* **Dual Annotation Modes:** Supports both tumor-specific queries (inferred from the filename) for targeted evidence and generic pan-cancer queries for broad analysis.
* **Smart Transcript Prioritization:** Implements a rigorous **3-tier selection logic** to ensure variants are annotated using the clinically relevant transcript (matching TSO500 standards), rather than just the VEP default.
* **Comprehensive Variant Handling:** Processes SNVs, Indels, and Copy Number Alterations (CNVs), with specific support for **Manta** structural variant callers (handling `MantaDUP`, `MantaDEL`, and `MantaINS` correctly).
* **Traceability:** Adds metadata fields (`GENE_EXIST`, `VARIANT_EXIST`) to explicitly track what was found in the database versus what was queried.

#### Logic and Workflow

1.  **Tumor Type Inference**
    * The script parses the input VCF filename against a predefined dictionary (`CANCER_MAP`) to detect the tumor type (e.g., "Lung", "Breast").
    * This ensures OncoKB returns evidence levels specific to that cancer context (e.g., Level 1 evidence for *EGFR* L858R in Lung Cancer vs. Level 3 in other types).
    * *Option:* Use `--tumor_mode=generic` to force a non-specific query ("UNKNOWN" tumor type) for pan-cancer evidence. Based on Oncokb documentation, generic is a better option but TODO I need to compare both results.

2.  **Variant Classification**
    * The script reads the VCF and intelligently classifies each record to determine the correct OncoKB API endpoint:
        * **Mutations (SNV/Indel/INS/BND):** Queries the `/annotate/mutations/byProteinChange` endpoint. This includes Structural Insertions (`MantaINS`) which are treated as mutations to capture protein changes (e.g., Exon 20 insertions).
        * **CNVs (DUP/DEL):** Queries the `/annotate/copyNumberAlterations` endpoint. This specifically targets Amplifications (`MantaDUP`, `GAIN`) and Deletions (`MantaDEL`, `LOSS`).

> **‚ÑπÔ∏è Technical Note: Handling Structural Insertions (`MantaINS`)**
>
> In this pipeline, **Structural Insertions** (`MantaINS`) are intentionally routed to the **Mutation** endpoint (`/annotate/mutations/byProteinChange`) rather than the Copy Number Alteration (CNV) endpoint. This is done for two critical reasons:
>
> 1.  **Clinical Biology:** Unlike simple Duplications (which increase gene dosage), Insertions often alter the internal sequence of the gene (e.g., **EGFR Exon 20 insertions**). These disruptions create specific mutant proteins that require distinct targeted therapies, which are completely different from therapies used for gene amplifications.
> 2.  **API Constraints:** The OncoKB CNV endpoint is strictly typed and **only** accepts `AMPLIFICATION`, `DELETION`, `GAIN`, or `LOSS`. It explicitly rejects `INSERTION`.
>
> By treating `MantaINS` as mutations, the pipeline leverages the Protein Change (HGVSp) calculated by VEP, ensuring that complex, actionable structural mutations are correctly identified and not misclassified as generic "amplifications."

3.  **Transcript Selection Strategy (Crucial Step)**
    To ensure the variant is annotated using the clinically relevant isoform, the script parses the VEP `CSQ` field using a **3-Tier Priority System**:
    * **Tier 1 (Preferred List):** Checks if any transcript in the VEP annotation matches a RefSeq ID (NM_*) found in `TSO500_transcripts_list.txt`. Matches are **version-agnostic** (e.g., `NM_000057.4` in the VCF will match `NM_000057` in the list).
    * **Tier 2 (MANE Select):** If no Tier 1 match is found, it searches for the transcript tagged as **MANE Select** or **MANE Plus Clinical** by Ensembl/NCBI.
    * **Tier 3 (Fallback):** If neither is found, it defaults to the first transcript reported by VEP.

4.  **API Query & Annotation**
    * Constructs a query using the Gene Symbol, Protein Change (converted to 1-letter code, e.g., `P2053L`), and Tumor Type.
    * The JSON response from OncoKB is flattened and written back into the VCF as new `INFO` fields.


### Step 5: VCF2table

This script performs the final step of the pipeline: parsing the fully annotated VCF file and converting it into a structured, analysis-ready CSV table.

Crucially, it implements the **exact same 3-Tier Transcript Selection Logic** as the OncoKB annotator (`oncokb2.0.py`). This ensures data consistency: the transcript displayed in your final table is guaranteed to be the same transcript used to query OncoKB for clinical evidence.

#### Key Features

* **Consistent Prioritization:** Uses the hierarchy `Preferred List > MANE Select > MANE Plus Clinical > Fallback` to extract the most relevant VEP annotation for every variant.
* **Version-Agnostic Matching:** Safely handles RefSeq IDs by stripping version numbers (e.g., matching `NM_004958.4` in the VCF to `NM_004958` in your list).
* **Customizable Columns:** Allows you to define exactly which VEP fields and OncoKB INFO tags appear in the output via external configuration files.
* **Robust Parsing:** Handles complex VEP `CSQ` strings and multi-allelic variants correctly.

#### Logic and Workflow

1.  **Configuration Loading**
    * Reads the list of OncoKB tags from `--oncokb-fields`.
    * Loads the preferred transcript list (`--transcripts`), stripping any version numbers to ensure robust matching.

2.  **Variant Iteration**
    * Reads the input VCF line by line.
    * Extracts global `INFO` tags (like OncoKB results) which apply to the variant as a whole.
    * Parses the `CSQ` (Consequence) string, which contains annotations for multiple transcripts.

3.  **Transcript Selection (The Core Logic)**
    For each variant, the script evaluates all available transcript annotations using the following priority:
    * **Tier 1 (Preferred):** Does the annotation contain an NM ID (in `MANE_SELECT`, `MANE_PLUS_CLINICAL`, or `HGVSc`) that matches your `TSO500` list?
    * **Tier 2 (MANE Select):** If not, is it tagged as the *MANE Plus Clinical* transcript?
    * **Tier 3 (MANE Plus Clinical):** If not, is it tagged as *MANE Select*?
    * **Tier 4 (Fallback):** If none of the above, use the first annotation provided by VEP (default behavior).

4.  **Output Generation**
    * Combines the standard VCF columns (`CHROM`, `POS`, `REF`, `ALT`), the selected transcript ID (`NM_Transcript`), the selection method used (for QC), the specific VEP annotation fields for that transcript, and the OncoKB data.
## Annotation

### Core VCF columns

| Field | Description |
|------|-------------|
| CHROM | Chromosome name | 
| POS | 1-based position of the variant | 
| ID | Variant identifier (e.g. rsID), if available | 
| REF | Reference allele | 
| ALT | Alternate allele(s) |
| QUAL | Variant quality score | 
| FILTER | Filter status (all variants are marked as PASS because filtering is applied upstream at the beginning of the pipeline)| 
| FORMAT | Per-sample data format specification | 


### FORMAT values
| Name | Description |
|------|-------------|
| AD | Allelic depths (counting only informative reads out of the total reads) for the ref and alt alleles in the order listed |
| AF | Allele fractions for alt alleles in the order listed |
| DP | Approximate read depth (reads with MQ=255 or with bad mates are filtered) |
| F1R2 | Count of reads in F1R2 pair orientation supporting each allele |
| F2R1 | Count of reads in F2R1 pair orientation supporting each allele |
| FT | Genotype-level filter |
| GT | Genotype |
| MB | Per-sample component statistics to detect mate bias |
| OBC | Orientation Bias Filter base context |
| OBPa | Orientation Bias prior for artifact |
| OBParc | Orientation Bias prior for reverse complement artifact |
| OBPsnp | Orientation Bias prior for real variant |
| PR | Spanning paired-read support for the ref and alt alleles in the order listed |
| PS | Physical phasing ID information, where each unique ID within a given sample (but not across samples) connects records within a phasing group |
| SB | Per-sample component statistics which comprise Fisher‚Äôs Exact Test to detect strand bias |
| SQ | Somatic quality |
| SR | Split reads for the ref and alt alleles in the order listed, for reads where P(allele\|read) > 0.999 |


### VEP Annotation

| Field | Description | Source |
|------|-------------|--------|
| Allele | ALT allele associated with this consequence | Ensembl VEP |
| Consequence | Sequence Ontology consequence term(s) | Ensembl VEP |
| IMPACT | Impact category (HIGH, MODERATE, LOW, MODIFIER) | Ensembl VEP |
| SYMBOL | Gene symbol | Ensembl VEP |
| Gene | Ensembl gene identifier | Ensembl VEP |
| Feature_type | Type of annotated feature (e.g. Transcript, RegulatoryFeature) | Ensembl VEP |
| Feature | Feature identifier (e.g. ENST transcript ID) | Ensembl VEP |
| BIOTYPE | Transcript biotype (e.g. protein_coding) | Ensembl VEP |
| EXON | Exon number and total exons | Ensembl VEP |
| INTRON | Intron number and total introns | Ensembl VEP |
| HGVSc | HGVS coding DNA sequence notation | Ensembl VEP |
| HGVSp | HGVS protein sequence notation | Ensembl VEP |
| cDNA_position | Position within the transcript cDNA | Ensembl VEP |
| CDS_position | Position within the coding sequence | Ensembl VEP |
| Protein_position | Amino acid position within the protein | Ensembl VEP |
| Amino_acids | Reference and alternate amino acids | Ensembl VEP |
| Codons | Reference and alternate codons | Ensembl VEP |
| Existing_variation | Known variant identifiers (e.g. rsID) | Ensembl VEP |
| DISTANCE | Distance to the nearest feature for non-overlapping variants | Ensembl VEP |
| STRAND | Strand of the annotated feature | Ensembl VEP |
| FLAGS | Internal VEP annotation flags | Ensembl VEP |
| VARIANT_CLASS | High-level variant class (e.g. SNV, insertion, deletion) | Ensembl VEP |
| SYMBOL_SOURCE | Source of the gene symbol (e.g. HGNC) | Ensembl VEP |
| HGNC_ID | HGNC gene identifier | Ensembl VEP |
| CANONICAL | Indicates whether the transcript is Ensembl canonical | Ensembl VEP |
| MANE | MANE annotation label | Ensembl / MANE |
| MANE_SELECT | MANE Select RefSeq transcript identifier | Ensembl / MANE |
| MANE_PLUS_CLINICAL | MANE Plus Clinical RefSeq transcript identifier | Ensembl / MANE |
| TSL | Transcript Support Level | Ensembl |
| APPRIS | APPRIS principal isoform annotation | Ensembl |
| CCDS | Consensus CDS (CCDS) identifier | CCDS |
| ENSP | Ensembl protein identifier | Ensembl |
| SWISSPROT | UniProt Swiss-Prot accession | UniProt |
| TREMBL | UniProt TrEMBL accession | UniProt |
| UNIPARC | UniParc identifier | UniProt |
| UNIPROT_ISOFORM | UniProt isoform identifier | UniProt |
| SOURCE | Transcript source (Ensembl or RefSeq) | Ensembl VEP |
| GENE_PHENO | Indicates gene‚Äìphenotype association | Ensembl VEP |
| SIFT | SIFT protein impact prediction | Ensembl VEP |
| PolyPhen | PolyPhen protein impact prediction | Ensembl VEP |
| DOMAINS | Overlapping protein domain annotations | Ensembl VEP |
| miRNA | miRNA-related annotation | Ensembl VEP |
| HGVS_OFFSET | HGVS offset for complex variants | Ensembl VEP |


### Population Frecuency

| Field | Description | Source |
|------|-------------|--------|
| AF | Global allele frequency across all populations | Ensembl VEP / gnomAD |
| AFR_AF | Allele frequency in African/African-American population | gnomAD |
| AMR_AF | Allele frequency in Admixed American population | gnomAD |
| EAS_AF | Allele frequency in East Asian population | gnomAD |
| EUR_AF | Allele frequency in European population | gnomAD |
| SAS_AF | Allele frequency in South Asian population | gnomAD |
| gnomADe_AF | Overall allele frequency in gnomAD exomes | gnomAD (exomes) |
| gnomADe_AFR_AF | Allele frequency in African population (exomes) | gnomAD (exomes) |
| gnomADe_AMR_AF | Allele frequency in Admixed American population (exomes) | gnomAD (exomes) |
| gnomADe_ASJ_AF | Allele frequency in Ashkenazi Jewish population (exomes) | gnomAD (exomes) |
| gnomADe_EAS_AF | Allele frequency in East Asian population (exomes) | gnomAD (exomes) |
| gnomADe_FIN_AF | Allele frequency in Finnish population (exomes) | gnomAD (exomes) |
| gnomADe_MID_AF | Allele frequency in Middle Eastern population (exomes), when available | gnomAD (exomes) |
| gnomADe_NFE_AF | Allele frequency in Non-Finnish European population (exomes) | gnomAD (exomes) |
| gnomADe_REMAINING_AF | Allele frequency in remaining/other populations (exomes) | gnomAD (exomes) |
| gnomADe_SAS_AF | Allele frequency in South Asian population (exomes) | gnomAD (exomes) |
| gnomADg_AF | Overall allele frequency in gnomAD genomes | gnomAD (genomes) |
| gnomADg_AFR_AF | Allele frequency in African population (genomes) | gnomAD (genomes) |
| gnomADg_AMI_AF | Allele frequency in Amish population (genomes), when available | gnomAD (genomes) |
| gnomADg_AMR_AF | Allele frequency in Admixed American population (genomes) | gnomAD (genomes) |
| gnomADg_ASJ_AF | Allele frequency in Ashkenazi Jewish population (genomes) | gnomAD (genomes) |
| gnomADg_EAS_AF | Allele frequency in East Asian population (genomes) | gnomAD (genomes) |
| gnomADg_FIN_AF | Allele frequency in Finnish population (genomes) | gnomAD (genomes) |
| gnomADg_MID_AF | Allele frequency in Middle Eastern population (genomes), when available | gnomAD (genomes) |
| gnomADg_NFE_AF | Allele frequency in Non-Finnish European population (genomes) | gnomAD (genomes) |
| gnomADg_REMAINING_AF | Allele frequency in remaining/other populations (genomes) | gnomAD (genomes) |
| gnomADg_SAS_AF | Allele frequency in South Asian population (genomes) | gnomAD (genomes) |
| LOEUF | Loss-of-function observed/expected upper bound fraction | LOEUF |

### Regulatory & motif annotations

| Field | Description | Source |
|------|-------------|--------|
| MOTIF_NAME | Transcription factor binding motif name | Ensembl Regulatory Build |
| MOTIF_POS | Position within the motif | Ensembl Regulatory Build |
| HIGH_INF_POS | Indicates highly informative motif position | Ensembl |
| MOTIF_SCORE_CHANGE | Change in motif score due to variant | Ensembl |
| TRANSCRIPTION_FACTORS | Associated transcription factors | Ensembl |

### SpliceAI & REVEL (VEP plugins)

| Name | Description |
|------|-------------|
| SpliceAI_cutoff | Flag indicating whether the SpliceAI delta score passes the cutoff (PASS) or not (FAIL) |
| SpliceAI_pred_DP_AG | SpliceAI (v1.3) predicted effect on splicing: delta position for acceptor gain |
| SpliceAI_pred_DP_AL | SpliceAI (v1.3) predicted effect on splicing: delta position for acceptor loss |
| SpliceAI_pred_DP_DG | SpliceAI (v1.3) predicted effect on splicing: delta position for donor gain |
| SpliceAI_pred_DP_DL | SpliceAI (v1.3) predicted effect on splicing: delta position for donor loss |
| SpliceAI_pred_DS_AG | SpliceAI (v1.3) predicted effect on splicing: delta score for acceptor gain |
| SpliceAI_pred_DS_AL | SpliceAI (v1.3) predicted effect on splicing: delta score for acceptor loss |
| SpliceAI_pred_DS_DG | SpliceAI (v1.3) predicted effect on splicing: delta score for donor gain |
| SpliceAI_pred_DS_DL | SpliceAI (v1.3) predicted effect on splicing: delta score for donor loss |
| SpliceAI_pred_SYMBOL | SpliceAI (v1.3) gene symbol |
| REVEL | Missense pathogenicity score | 

### CIViC annotations

| Field | Description | Source |
|------|-------------|--------|
| CIViC | CIViC annotation presence | CIViC |
| CIViC_GN | CIViC gene name | CIViC |
| CIViC_VT | CIViC variant type | CIViC |
| CIViC_CSQ | CIViC clinical consequence | CIViC |


### ClinVar annotations
| Field | Description | Source |
|------|-------------|--------|
| Allele | ALT allele associated with this consequence | Ensembl VEP |
| Consequence | Sequence Ontology consequence term(s) | Ensembl VEP |
| IMPACT | Impact category (HIGH, MODERATE, LOW, MODIFIER) | Ensembl VEP |
| SYMBOL | Gene symbol | Ensembl VEP |
| Gene | Ensembl gene identifier | Ensembl VEP |
| Feature_type | Type of annotated feature (e.g. Transcript, RegulatoryFeature) | Ensembl VEP |
| Feature | Feature identifier (e.g. ENST transcript ID) | Ensembl VEP |
| BIOTYPE | Transcript biotype (e.g. protein_coding) | Ensembl VEP |
| EXON | Exon number and total exons | Ensembl VEP |
| INTRON | Intron number and total introns | Ensembl VEP |
| HGVSc | HGVS coding DNA sequence notation | Ensembl VEP |
| HGVSp | HGVS protein sequence notation | Ensembl VEP |
| cDNA_position | Position within the transcript cDNA | Ensembl VEP |
| CDS_position | Position within the coding sequence | Ensembl VEP |
| Protein_position | Amino acid position within the protein | Ensembl VEP |
| Amino_acids | Reference and alternate amino acids | Ensembl VEP |
| Codons | Reference and alternate codons | Ensembl VEP |
| Existing_variation | Known variant identifiers (e.g. rsID) | Ensembl VEP |
| DISTANCE | Distance to the nearest feature for non-overlapping variants | Ensembl VEP |
| STRAND | Strand of the annotated feature | Ensembl VEP |
| FLAGS | Internal VEP annotation flags | Ensembl VEP |
| VARIANT_CLASS | High-level variant class (e.g. SNV, insertion, deletion) | Ensembl VEP |
| SYMBOL_SOURCE | Source of the gene symbol (e.g. HGNC) | Ensembl VEP |
| HGNC_ID | HGNC gene identifier | Ensembl VEP |
| CANONICAL | Indicates whether the transcript is Ensembl canonical | Ensembl VEP |
| MANE | MANE annotation label | Ensembl / MANE |
| MANE_SELECT | MANE Select RefSeq transcript identifier | Ensembl / MANE |
| MANE_PLUS_CLINICAL | MANE Plus Clinical RefSeq transcript identifier | Ensembl / MANE |
| TSL | Transcript Support Level | Ensembl |
| APPRIS | APPRIS principal isoform annotation | Ensembl |
| CCDS | Consensus CDS (CCDS) identifier | CCDS |
| ENSP | Ensembl protein identifier | Ensembl |
| SWISSPROT | UniProt Swiss-Prot accession | UniProt |
| TREMBL | UniProt TrEMBL accession | UniProt |
| UNIPARC | UniParc identifier | UniProt |
| UNIPROT_ISOFORM | UniProt isoform identifier | UniProt |
| SOURCE | Transcript source (Ensembl or RefSeq) | Ensembl VEP |
| GENE_PHENO | Indicates gene‚Äìphenotype association | Ensembl VEP |
| SIFT | SIFT protein impact prediction | Ensembl VEP |
| PolyPhen | PolyPhen protein impact prediction | Ensembl VEP |
| DOMAINS | Overlapping protein domain annotations | Ensembl VEP |
| miRNA | miRNA-related annotation | Ensembl VEP |
| HGVS_OFFSET | HGVS offset for complex variants | Ensembl VEP |


### CancerHotspots annotations
| Field | Description |
|------|-------------|
| CancerHotspots | Cancer Hotspots annotation source |
| CancerHotspots_HOTSPOT | Hotspot flag |
| CancerHotspots_HOTSPOT_GENE | Gene associated with hotspot |
| CancerHotspots_HOTSPOT_HGVSp | Protein-level HGVS for hotspot |
| CancerHotspots_HOTSPOT3D | 3D hotspot flag |
| CancerHotspots_HOTSPOT3D_GENE | Gene associated with 3D hotspot |
| CancerHotspots_HOTSPOT3D_HGVSp | Protein HGVS for 3D hotspot |
| CancerHotspots_HOTSPOTNC | Non-coding hotspot flag |
| CancerHotspots_HOTSPOTNC_GENE | Gene associated with non-coding hotspot |
| CancerHotspots_HOTSPOTNC_HGVSc | Coding HGVS for non-coding hotspot |

### OncoKB
| Field | Description |
|------|-------------|
| ONCOKB_ONCOGENIC | OncoKB oncogenic classification |
| ONCOKB_HOTSPOT | OncoKB hotspot flag |
| ONCOKB_EFFECT | OncoKB known mutation effect |
| ONCOKB_EFFECT_DESC | Description of mutation effect |
| ONCOKB_SENS_LVL | Highest sensitive therapeutic level |
| ONCOKB_RESIST_LVL | Highest resistance level |
| ONCOKB_DIAG_LVL | Highest diagnostic implication level |
| ONCOKB_PROG_LVL | Highest prognostic implication level |
| ONCOKB_TREATMENTS | OncoKB treatment summary |
| ONCOKB_GENE_SUMMARY | OncoKB gene summary |
| ONCOKB_VARIANT_SUMMARY | OncoKB variant summary |
| ONCOKB_TUMOR_TYPE_SUMMARY | OncoKB tumor type summary |
| ONCOKB_DIAG_SUMMARY | OncoKB diagnostic summary |
| ONCOKB_PROG_SUMMARY | OncoKB prognostic summary |
| ONCOKB_VUS | OncoKB variant of unknown significance classification |
| ONCOKB_GENE_EXIST | Indicates whether the gene is curated in OncoKB |
| ONCOKB_VARIANT_EXIST | Indicates whether the variant is curated in OncoKB |
| ONCOKB_DATA_VERSION | OncoKB data version |
| ONCOKB_LAST_UPDATE | OncoKB last update date |
| ONCOKB_JSON | Raw OncoKB JSON payload |
| ONCOKB_QUERY_TYPE | OncoKB query type (e.g. MUTATION, CNA) |
| hotspot | Known somatic site used to increase confidence in the call |

‚ùå ***I have left an example of one table in the the folder Output_Results***

## üìù TODO List
- [ ] End to end analysis over the 420 samples again and check we dont miss variants. 
- [ ] Check what variants are rejected by liftover. We shouldn't reject many as all our variants in this step are PASS only.
- [ ] Repeat the analysis twice (generic vs. tumour type) anc check what shows better annotation
- [ ] Validation/test. I need to create a very small VCF with variants that shows all annotation in OncoKB. In a preliminar view, all variants are unkonwn. I need the final table to see is there is non-unknown variants or test with kown variants in a sitetic VCF and see what is going on. For instance I dont know the decistion taken to Handling Structural Insertions is correct. 
- [X] Tools version
- [X] Add all VEP annotation, including loeuf
- [ ] Discussion needed about the final output table.
- [ ] Run VEP in tab version and check all annotation (apart from oncoKB) is what we found in the final table.
- [ ] VALIDATION: Ian suggested providing variants with known annotations to ensure the annotation process makes sense, which is especially important for OncoKB.
- [ ] To add sample name in the final table.

## Where the data in the ArchiveData server is
```bash
/mnt/ArchiveData/results/TSO500_WESSEX
‚îú‚îÄ‚îÄ excel_and_other_files_provided   # Documents and other files shared by the team or Birmingham Bioinformatics
‚îú‚îÄ‚îÄ raw                              # Raw sequencing data
‚îÇ   ‚îî‚îÄ‚îÄ files                        # All TSO500 FASTQ (.ora) files
‚îú‚îÄ‚îÄ README.md                        # Documentation explaining how the data are organised
‚îú‚îÄ‚îÄ scripts                          # Scripts for data integrity checks and TSO500 sample grouping
‚îî‚îÄ‚îÄ VCFs                             # Variant Call Format (VCF) files
    ‚îî‚îÄ‚îÄ files                        # All TSO500 VCF files
        ‚îî‚îÄ‚îÄ AnnotatedVEP             # 418 PASS, liftover-processed, and VEP-annotated TSO500 VCFs file + DoIt.log (log file showing liftover and VEP analysis records )
```

## Tool Versions

The following tool and format versions were used to generate the data:

- Variant Call Format (VCF): version 4.2 (data provided by Birmingham)
- GATK LiftoverVcf: version 4.6.0.0
- Ensembl VEP: version 114.2
- OncoKB: version 5.4
- SpliceAI: version 1.3
- REVEL: revel-v1.3_all_chromosomes
- CIVIC: civic_01_10_25
- Homo Sapiens: 114_GRCh38


